---
title: "Assignment 5"
author: "AnnaClaire Marley"
date: "11/28/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(car)



faculty <- read_csv("Faculty_salary_data_cleaned.csv")
grad <- read_csv("Grad_enrollment_cleaned.csv")
grad2 <- read_csv("Grad_enroll_clean2.csv")
median <- read_csv("Median_salary_cleaned.csv")
phd_fields <- read_csv("F_PhD_Fields.csv")
phd_tidy <- read_csv("PhD_tidy.csv")
phd_chi <-read_csv("Field_chisquared.csv")

```


1. Male and female graduate enrollment (1967 - 2015). Compare trends in total graduate enrollment for males and females (including full-time/part-time and private/public universities) in the United States from 1967 - 2015. Describe your results statistically, graphically and in text. 

**reminder: cannot split public_all/private_All by gender does not equate to gender column**

```{r}
# Exploratory line graphs

###########################This is what the assingment asks for##############################################
# total enrollment males vs females
total_enrol <- grad2 %>% 
  ggplot(aes(x = Year, y = Total)) +
  geom_line(aes(color = Gender)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Enrollment in Post-Secondary Institutions"
  ) +
  scale_x_continuous(expand=c(0,0))

total_enrol
##################################################################################

# Below are extra graphs if we want
# full time enrollment men vs women
full_time <- grad2 %>% 
  ggplot(aes(x = Year, y = Full_time)) +
  geom_line(aes(color = Gender)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Full Time Enrollment in Post-Secondary Institutions"
  ) +
  scale_x_continuous(expand=c(0,0))

full_time

# part time enrollment men vs women 

part_time <- grad2 %>% 
  ggplot(aes(x = Year, y = Part_time)) +
  geom_line(aes(color = Gender)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Part Time Enrollment in Post-Secondary Institutions"
  ) +
  scale_x_continuous(expand=c(0,0))

part_time


```

Continuation of 1: Statistical tests
Need to compare enrollment over time of men vs women

```{r}
# Normality tests

########## idk if necessary ###################################
Ftotal_hist <- grad %>% 
  ggplot(aes(x = Total_F)) +
  geom_histogram()

Ftotal_hist
 
Ftotal_qq <- grad %>% 
  ggplot(aes(sample = Total_F)) +
  geom_qq()

Ftotal_qq
   
  
Mtotal_hist <- grad %>% 
  ggplot(aes(x = Total_M)) +
  geom_histogram()

Mtotal_hist
 
Mtotal_qq <- grad %>% 
  ggplot(aes(sample = Total_M)) +
  geom_qq()

Mtotal_qq

###################################################

```

```{r}

####### Linear Regression #####################

enroll_lm1 <- lm(Total_M ~ Year, data = grad)
# Male Salary = -17112153 + 9069(Year)

enroll_lm2 <- lm(Total_F ~ Year, data = grad)
# Female salary = -58955502 + 30126 


# check the model diagnostics

par(mfrow = c(2,2))
  plot(enroll_lm1)
  
par(mfrow = c(2,2))
  plot(enroll_lm2)
  
# check model fit
  summary(enroll_lm1) 
 # overall model fit p < 0.001
  

  
####### Regression graphs ######
  
male_enroll_graph <- ggplot(grad, aes(x = Year, y = Total_M)) + 
  geom_point() +
  geom_smooth(method = lm, se = TRUE, size = 0.5, color = "gray20") + theme_bw() +
  scale_x_continuous(expand = c(0,0), limits = c(1967, 2015)) +
  labs(x = "Year", y = "Male Enrollment")
male_enroll_graph

female_enroll_graph <- ggplot(grad, aes(x = Year, y = Total_F)) + 
  geom_point() +
  geom_smooth(method = lm, se = TRUE, size = 0.5, color = "gray20") + theme_bw() +
  scale_x_continuous(expand = c(0,0), limits = c(1967, 2015)) +
  labs(x = "Year", y = "Female Enrollment")
female_enroll_graph

#### Both male and female enrollment linear regressions  ############
all_enroll_graph <- ggplot(grad, aes(x = Year, y = Total_M)) + 
  geom_point() +
  geom_smooth(method = lm, se = TRUE, size = 0.5, color = "gray20") + theme_bw() +
  scale_x_continuous(expand = c(0,0), limits = c(1967, 2015)) +
  geom_point(data = grad, aes(x =  Year, y = Total_F)) +
  geom_smooth(data = grad, aes(x =  Year, y = Total_F), method = lm, se = TRUE, size = 0.5, color = "gray20") +    theme_bw() +
  labs(x = "Year", y = "Enrollment")
all_enroll_graph
```




2. Shifts in female PhD recipients by field (1985, 2000, and 2015). Describe if and how there was a shift in PhDs awarded to females in four fields (Physical and Earth Sciences, Engineering, Education, and Humanities & Arts) in 1985, 2000, and 2015. Describe your results statistically, in a graph or table, and in text. Note: There are several ways that you can interpret this question. You are invited to decide which you think is/are most interesting. Just be really clear about what you are asking/answering in your report.

```{r}

# exploratory column graph

phd_shifts <- phd_tidy %>% 
  filter(Field == "Physical science" | Field == "Engineering" | Field == "Education" | Field == "Humanities", Sex    == "F") %>% 
  ggplot(aes(x = Year, y = Number)) +
  geom_col(aes(fill = Field), position = "dodge") +
  scale_x_continuous(expand=c(0,0), breaks = seq(1985,2015, by=15)) +
  scale_y_continuous(expand=c(0,0)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Female PhDs Awarded"
  )

phd_shifts

#chi squared test on female "is there a sigificant difference in females receiving doctoral degrees in each field in 1985, 2000 and 2015?"

#Ho - there is no association between year and number of women in each field 
#Ha - there IS an association between year and number of women in each field 


phd_chi2 <- phd_chi %>% 
  select(-Year) %>%
  filter(physical != "NA")

row.names(phd_chi2) <- c("1985","2000","2015")

#Perform chi-square 

phd_x2test <- chisq.test(phd_chi2) 

phd_x2test

#we reject the null hypothesis beacuse the p-value is < .001. The field in which women receive their doctoral degrees differs significantly between 1985, 2000 and 2015. There is a significant association between year and number of docotoral degrees awarded to women in each field. 


#next: make a table

phdfield_prop <- prop.table(as.matrix(phd_chi2), 1) %>% 
  round(2)

phdfield_prop




```


3. Male and female salaries for starting postdoctoral and other employment positions (2015). Compare median salaries for male and female doctorate recipients in 2015. Answer these two questions: Does median salary differ significantly between male and female starting postdoc positions? Does median salary differ significantly between male and female PhD recipients in non-postdoc employment positions?

```{r}
# Comparing medians use Mann-Whitney U.

################## Compare median salaries for post-doc positions ################

#First test for equal variance

# Mann-Whitney U

# Cliffs Delta (effect size)

# Actual difference in medians 

emp_male_median <- median(median$`Emp M`)
emp_female_median <- median(median$`Emp F`)
emp_male_median - emp_female_median
# median male = 75167
# median female = 71750
# difference male - female = 3417

################### compare median salaries for non-postdoc positions ###############

# Explotory histogram - male median salaries 
# bins
k <- 2*((NROW(na.omit(median$`PS M`)))^(1/3))

psmale_hist <- ggplot(median, aes(x = `PS M`)) +
  geom_histogram(bins = k) +
  theme_classic() +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous (expand = c(0,0))
psmale_hist

# normal - more evenly spread 

# Exploratory QQ - male median salary 

psmale_qq <- ggplot(median, aes(sample = `PS M`)) +
  geom_qq() 
psmale_qq

# overall normal, a few more abnormal points between theoretical 0 and 1 

# histogram - female median salary
#bins
k <- 2*((NROW(na.omit(median$`PS F`)))^(1/3))

psfemale_hist <- ggplot(median, aes(x = `PS F`)) +
  geom_histogram(bins = k) +
  theme_classic() +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous (expand = c(0,0))
psfemale_hist

# relatively normal  

# Exploratory QQ - female median salary 

psfemale_qq <- ggplot(median, aes(sample = `PS F`)) +
  geom_qq() 
psfemale_qq

# overall relatively normal

# Mann-Whitney U

# HO: Ranks are equal (medians are equal)
# HA: Ranks are NOT equal

ps_mwu <- wilcox.test(median$`PS M`, median$`PS F`)
ps_mwu

# W = 117 p-value = 0.8671 (NOT significant)

# Cliffs Delta (effect size)

ps_cliff <- cliff.delta(median$`PS M`, median$`PS F`)
ps_cliff
# Cliff delta = 0.04 (negligible)

# Actual difference in medians 

ps_male_median <- median(median$`PS M`)
ps_female_median <- median(median$`PS F`)
ps_male_median - ps_female_median
# median male = 48000
# median female = 45000
# difference male - female = 3000

############################# Box & Whisker plot Emp #################################
emp_median <- median_box %>% 
  filter(type == "emp")

empmedian_box <- ggplot(emp_median, aes(x = sex, y = salary)) +
  geom_boxplot()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"),text = element_text(family = "Arial"))+
  xlab("Sex")+
  ylab("Median Salary") +
  scale_x_discrete(breaks = c("female","male"), labels = c("Female", "Male"))
  
empmedian_box

########################### Box & Whisker plot Postdoc ###############################
ps_median <- median_box %>% 
  filter(type == "ps")

psmedian_box <- ggplot(ps_median, aes(x = sex, y = salary)) +
  geom_boxplot()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"),text = element_text(family = "Arial"))+
  xlab("Sex")+
  ylab("Median Salary") +
  scale_x_discrete(breaks = c("female","male"), labels = c("Female", "Male"))
  
psmedian_box
```


4. Exploring academic salaries for professors in U.S. colleges. Explore relationships between variables in the ‘Faculty salary data (2008 - 2009 survey)’ dataset. Develop a model describing faculty salary based on data for faculty sex, rank, years in current position, field, and number of years since doctoral degree was earned. You should make decisions regarding which variables should remain in your final model. Describe the results qualitatively and quantitatively (i.e., don’t just report the statistical results of the model – make sure you describe interesting findings in text). You can also discuss any concerns that you have with the model(s) you present, if any.

```{r}

# tests on the data

# correlation years since phd and years faculty service
yrs_plot <- faculty %>% 
  ggplot(aes(x = Yrs_Since_PhD, y = Yrs_Faculty_Service)) +
  geom_point(aes(color = Sex), alpha = 0.5)

yrs_plot

#correlation years faculty service vs salary

service_plot <- faculty %>% 
  ggplot(aes(x = Yrs_Faculty_Service, y = Salary)) +
  geom_point(aes(color = Sex), alpha = 0.5)

service_plot

#correlation years faculty service v salary 

salary_yrs_plot <- faculty %>% 
  ggplot(aes(x = Yrs_Since_PhD, y = Salary)) +
  geom_point(aes(color = Sex), alpha = 0.5)

salary_yrs_plot

# change reference levles

# Rank: reference level = profesor
faculty$Rank <- factor(faculty$Rank)
faculty$Rank <- fct_relevel(faculty$Rank, "Prof")

# aggregate model 
salary_lm1 <- lm(Salary ~ Rank + Yrs_Since_PhD + Yrs_Faculty_Service + Sex + Discipline, data = faculty)

vif(salary_lm1)
# yrs since phd = 7
# yrs faculty service = 5.9
# everything else less than 4

# summarized model

salary_lm2 <- lm(Salary ~ Rank + Yrs_Faculty_Service + Sex + Discipline, data = faculty)

#vif test on lm2

vif(salary_lm2)

#AIC on both models 

AIC(salary_lm1)
AIC(salary_lm2)

#lm1 has a lower AIC, but our judegement tells us lm2 is probably better 
```








